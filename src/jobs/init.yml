description: Execute terraform init command

executor:
  name: default
  tag: << parameters.terraform-version >>

parameters:
  path:
    description: Path to execute terraform command
    type: string
    default: .
  terraform-version:
    description: Terraform version
    type: string
    default: latest

steps:
  - restore_cache:
      name: Restore terraform plugins
      key: plugins-{{ .Branch }}
  - run:
      name: Execute terraform init
      command: terraform init
      working_directory: << parameters.path >>
  - save_cache:
      name: Cache terraform plugins
      key: plugins-{{ .Branch }}
      paths:
        - .terraform.d/plugin-cache
  - save_cache:
      name: Cache .terraform
      key: init-data-{{ .Revision }}
      paths:
        - << parameters.path >>/.terraform
